#!/usr/bin/env python
import re
import sys

# These are the relevant zone mappings 
# 	[30] = 864, -- "Elwynn Forest" => "Northshire"
# 	[9] = 890, -- "Mulgore" to "Camp Narache"
# 	[27] = {866, 895}, -- "Dun Morogue" to Coldridge Valley or New Tinkertown"
# 	[462] = 893, -- "Eversong to Sunstrider"
# 	[20] = 892, -- "Tirisfal Glades to Deathknell"
# 	[464] = 894, -- "Azuremyst Isle to Ammen Vale"
# 	[41] = 888, -- "Teldrassil to Shadowglen"
# 	[4] = {889,891}, -- "Durotar to Valley of Trials or Echo Isles"


Maps = {}
def DefineMap(id, height, width, xOffset, yOffset):
    global Maps
    Maps[id] = {}
    Maps[id]["height"] = height
    Maps[id]["width"] = width
    Maps[id]["xOffset"] = xOffset
    Maps[id]["yOffset"] = yOffset

DefineMap(4,3525,5287.5,1962.5,-1808.33)
DefineMap(9,3633.33,5450,-2204.17,168.75)
DefineMap(11,3831.25,5745.83,-202.083,-1810.42)
DefineMap(13,24533.2,36799.8,-17066.6,-12799.9)
DefineMap(14,27149.7,40741.2,-18172,-11176.3)
DefineMap(16,2318.75,3477.08,1127.08,141.667)
DefineMap(17,2045.83,3070.83,1902.08,5854.17)
DefineMap(19,2441.67,3662.5,1193.75,10583.3)
DefineMap(20,3012.5,4518.75,-3033.33,-3837.5)
DefineMap(21,2800,4200,-3450,-1666.67)
DefineMap(22,2866.67,4300,-416.667,-3366.67)
DefineMap(23,2687.5,4031.25,2287.5,-3704.17)
DefineMap(24,3241.67,4862.5,-1850,-1481.25)
DefineMap(26,2566.67,3850,1575,-1466.67)
DefineMap(27,3264.58,4897.92,-2137.5,3941.67)
DefineMap(28,1487.5,2231.25,322.917,6100)
DefineMap(29,2100,3152.08,464.583,6985.42)
DefineMap(30,2314.58,3470.83,-1535.42,7939.58)
DefineMap(32,1666.67,2500,833.333,9866.67)
DefineMap(0,22266.7,33400.1,0,0)
DefineMap(886,468.75,702.084,2497.92,789.584)
DefineMap(760,2266.67,3400,-2766.67,-3266.67)
DefineMap(888,966.667,1450,-1491.67,-11033.3)
DefineMap(761,1200,1800,-2766.67,-2733.33)
DefineMap(889,900,1350,3641.67,0)
DefineMap(890,1177.08,1766.67,-233.334,2577.08)
DefineMap(891,1204.17,1806.25,4491.67,525)
DefineMap(510,1814.58,2722.92,-1443.75,-6502.08)
DefineMap(40,2756.25,4135.42,389.583,2147.92)
DefineMap(892,727.083,1089.58,-2147.92,-2270.83)
DefineMap(893,1066.67,1600,2983.33,-8433.33)
DefineMap(894,1212.5,1818.75,-4785.42,-6529.17)
DefineMap(895,1233.33,1850,-1206.25,4727.08)
DefineMap(512,1162.5,1743.75,-787.5,-1883.33)
DefineMap(640,3400,5100,-3052.08,-2795.83)
DefineMap(768,2266.67,3400,-2766.67,-2200)
DefineMap(769,2800,4200,-2366.67,-600)
DefineMap(161,4808.33,7212.5,62.5,5770.83)
DefineMap(770,3514.58,5270.83,2437.5,2156.25)
DefineMap(899,504.166,756.249,-902.083,-4008.33)
DefineMap(772,2700,4050,-3891.67,8033.33)
DefineMap(81,3933.33,5900,-3902.08,-3404.17)
DefineMap(773,1733.33,2600,-2100,-600)
DefineMap(775,1666.67,2500,1525,-6145.83)
DefineMap(520,734.188,1101.28,-393.212,-798.263)
DefineMap(776,350,525,-475,-337.5)
DefineMap(522,647.917,972.917,233.333,-850)
DefineMap(906,706.25,1058.33,3979.17,3468.75)
DefineMap(779,370.667,556,-385.5,-255.333)
DefineMap(907,3500,5250,975,2033.33)
DefineMap(41,3916.67,5875,-4235.42,-11847.9)
DefineMap(780,1050,1575,-212.502,-650.002)
DefineMap(781,845.833,1268.75,-1852.08,-568.75)
DefineMap(526,2266.67,3400,-2766.67,-2200)
DefineMap(782,1050,1575,-787.5,-950)
DefineMap(910,3125,4687.5,-2947.92,110.416)
DefineMap(527,2266.67,3400,-2766.67,-2200)
DefineMap(911,745.834,1118.75,314.584,587.5)
DefineMap(912,1229.17,1845.83,-1931.25,891.666)
DefineMap(530,762.5,1143.75,-1310.42,-2122.92)
DefineMap(914,1195.83,1793.75,-812.5,-1689.58)
DefineMap(531,775,1162.5,-1133.33,-3616.67)
DefineMap(532,1733.33,2600,-1033.33,-600)
DefineMap(536,256.25,383.333,-983.333,-2006.25)
DefineMap(920,1554.17,2331.25,-3125,1352.08)
DefineMap(793,1414.58,2120.83,612.5,11225)
DefineMap(461,1170.83,1756.25,-1858.33,-1508.33)
DefineMap(539,2097.92,3145.83,-3439.58,533.333)
DefineMap(795,793.75,1189.58,-933.333,-1702.08)
DefineMap(462,3283.33,4925,2087.5,-8641.67)
DefineMap(540,1766.67,2650,-525,-1708.33)
DefineMap(42,4310.42,6464.58,-3016.67,-8222.92)
DefineMap(541,2452.08,3677.08,-2797.92,-10781.2)
DefineMap(797,437.5,658.333,-1935.42,1041.67)
DefineMap(925,156.25,233.332,4639.58,-2110.42)
DefineMap(542,1733.33,2600,-2100,-2200)
DefineMap(464,2714.58,4070.83,-7100,-7339.58)
DefineMap(544,3010.42,4514.58,-4383.33,-2881.25)
DefineMap(928,2756.25,4135.42,-8203.17,-7303.92)
DefineMap(545,2097.92,3145.83,-3439.58,533.333)
DefineMap(673,2631.25,3945.83,-2108.33,12516.7)
DefineMap(401,2825,4237.5,-1781.25,-1085.42)
DefineMap(929,1191.67,1787.5,-2004.17,-6697.92)
DefineMap(201,2466.67,3700,-533.333,5966.67)
DefineMap(803,734.19,1101.28,-7757.89,-4361.01)
DefineMap(466,11642.7,17464.1,-12996,-5821.36)
DefineMap(677,593.75,889.583,-1933.33,1306.25)
DefineMap(101,2997.92,4495.83,-4233.33,-452.083)
DefineMap(467,3352.08,5027.08,-9475,-1935.42)
DefineMap(678,2097.92,3145.83,-3439.58,533.333)
DefineMap(806,4654.17,6983.33,-1452.08,-3652.08)
DefineMap(934,1021.67,1532.5,-1632.5,-355.833)
DefineMap(679,2097.92,3145.83,-3439.58,533.333)
DefineMap(807,2616.67,3925,-2679.17,-1095.83)
DefineMap(935,722.918,1083.33,-1068.75,-189.584)
DefineMap(680,492.576,738.864,-452.871,-39.6232)
DefineMap(808,1779.17,2670.83,-4979.17,-1785.42)
DefineMap(341,527.604,790.625,713.591,4569.24)
DefineMap(809,4172.92,6258.33,-4839.58,-5618.75)
DefineMap(937,504.167,758.333,-1239.58,-1310.42)
DefineMap(682,3010.42,4514.58,-4383.33,-2881.25)
DefineMap(810,3829.17,5743.75,-7079.17,-4558.33)
DefineMap(938,1200,1800,-1966.67,-2200)
DefineMap(683,2831.25,4245.83,929.167,-6195.83)
DefineMap(811,1687.5,2533.33,-2481.25,-1947.92)
DefineMap(939,556.25,833.334,-145.834,4904.17)
DefineMap(35,1839.58,2758.33,1993.75,4487.5)
DefineMap(684,2097.92,3145.83,-3439.58,533.333)
DefineMap(940,464.584,697.916,3818.75,-2560.42)
DefineMap(685,593.75,889.583,-1933.33,1306.25)
DefineMap(813,1514.58,2270.83,-2660.42,-2918.75)
DefineMap(941,4077.08,6114.58,-7506.25,-8275)
DefineMap(686,922.917,1383.33,-1625,-2052.08)
DefineMap(687,463.353,695.029,-442.758,255.166)
DefineMap(816,833.333,1252.08,4650,-3766.67)
DefineMap(281,4100,6150,991.667,-8793.75)
DefineMap(689,4368.75,6552.08,-2977.08,10964.6)
DefineMap(473,3666.67,5500,-4225,1947.92)
DefineMap(141,3500,5250,975,2033.33)
DefineMap(690,252.102,378.153,-189.822,-220.633)
DefineMap(946,3975,5962.5,-5833.33,-4429.17)
DefineMap(947,4466.67,6700,-2268.75,-2660.42)
DefineMap(948,4039.58,6060.42,-4681.25,-1383.33)
DefineMap(949,5450,8177.09,-5066.67,-9589.58)
DefineMap(950,3783.34,5675,-9308.33,-4922.92)
DefineMap(823,1239.58,1858.33,-7268.75,3322.92)
DefineMap(951,1600,2400,4083.33,-233.334)
DefineMap(696,843.199,1264.8,130.76,-1303.06)
DefineMap(697,1252.08,1877.08,693.75,11308.3)
DefineMap(478,3600,5400,-7083.33,1000)
DefineMap(36,1712.5,2568.75,1479.17,8514.58)
DefineMap(700,3514.58,5270.83,2437.5,2156.25)
DefineMap(479,3716.67,5575,-5483.33,-5456.25)
DefineMap(480,806.771,1211.46,4000.75,-7753.71)
DefineMap(481,870.833,1306.25,-6135.26,1473.95)
DefineMap(241,1539.58,2308.33,1381.25,-8491.67)
DefineMap(482,1514.58,2270.83,-2660.42,-2918.75)
DefineMap(708,1343.75,2014.58,-4810.42,2160.42)
DefineMap(964,858.333,1287.5,-439.584,-2600)
DefineMap(709,1225,1837.5,-5212.5,1222.92)
DefineMap(121,4633.33,6950,-5441.67,2366.67)
DefineMap(710,709.165,1063.75,-631.108,-617.417)
DefineMap(970,1606.25,2408.33,1054.17,-4841.67)
DefineMap(486,3843.75,5764.58,-8570.83,-4897.92)
DefineMap(37,2733.33,4100,-1743.75,11016.7)
DefineMap(61,2933.33,4400,433.333,3966.67)
DefineMap(717,1675,2512.5,-3035.42,8233.33)
DefineMap(973,456.25,683.334,-545.834,-2091.67)
DefineMap(718,322.079,483.118,-111.383,-98.2458)
DefineMap(974,456.25,683.334,-545.834,-2091.67)
DefineMap(488,3739.58,5608.33,-3627.08,-5575)
DefineMap(720,4129.17,6193.75,-2441.67,8029.17)
DefineMap(976,468.75,702.083,-4885.42,-5814.58)
DefineMap(978,2081.25,3122.91,2672.92,-5577.08)
DefineMap(362,695.833,1043.75,-516.667,850)
DefineMap(851,706.25,1058.33,3979.17,3468.75)
DefineMap(490,3500,5250,1110.42,-5516.67)
DefineMap(724,561.015,841.522,-185.079,-62.7969)
DefineMap(980,468.75,702.083,-4885.42,-5814.58)
DefineMap(725,669.013,1003.52,-498.989,-603.136)
DefineMap(491,4031.25,6045.83,1397.92,-3116.67)
DefineMap(726,596.613,894.92,-240.977,-423.735)
DefineMap(982,468.75,702.083,-4885.42,-5814.58)
DefineMap(492,4181.25,6270.83,-5443.75,-9427.08)
DefineMap(728,593.372,890.058,-53.9341,-201.72)
DefineMap(856,560.416,839.583,-1743.75,-2083.33)
DefineMap(984,2266.67,3400,-4633.33,-2733.33)
DefineMap(601,7600,11400,-7033.33,-6466.67)
DefineMap(729,504.935,757.402,-649.753,-248.025)
DefineMap(857,3125,4687.5,-2947.92,110.416)
DefineMap(493,2904.17,4356.25,-6929.17,-7287.5)
DefineMap(602,1022.92,1533.33,-839.583,-1256.25)
DefineMap(858,3568.75,5352.08,-6139.58,-1416.67)
DefineMap(986,1733.33,2600,-4766.67,-4333.33)
DefineMap(603,8666.67,13000,-7033.33,-6466.67)
DefineMap(987,1200,1800,-100,-7533.33)
DefineMap(38,1672.92,2508.33,2081.25,9535.42)
DefineMap(732,548.857,823.285,-276.934,-90.0708)
DefineMap(860,1500,2250,-1320.83,-1495.83)
DefineMap(605,900,1352.08,-2129.17,7731.25)
DefineMap(733,725,1087.5,-7650,1500)
DefineMap(495,4741.67,7112.5,-1841.67,-10197.9)
DefineMap(606,2831.25,4245.83,929.167,-6195.83)
DefineMap(734,1554.17,2331.25,-1854.17,-3127.08)
DefineMap(862,10343.5,15515.3,-8752.86,-6679.16)
DefineMap(990,468.75,702.083,-4885.42,-5814.58)
DefineMap(607,4941.67,7412.5,-1356.25,-204.167)
DefineMap(496,3329.17,4993.75,600,-7668.75)
DefineMap(736,868.75,1302.08,-1745.83,-1604.17)
DefineMap(864,645.834,968.75,-187.5,8570.83)
DefineMap(992,2441.67,3662.5,1193.75,10583.3)
DefineMap(609,502.083,752.083,-902.083,-3429.17)
DefineMap(737,1033.33,1550,-1556.25,-1370.83)
DefineMap(610,1868.75,2802.08,-5070.83,4018.75)
DefineMap(866,643.75,964.583,-979.167,5962.5)
DefineMap(611,593.75,889.583,-1933.33,1306.25)
DefineMap(613,4631.25,6945.83,-8754.17,3720.83)
DefineMap(477,3683.33,5525,-10295.8,-41.6667)
DefineMap(499,2218.75,3327.08,2902.08,-11168.7)
DefineMap(614,2716.67,4075,-8233.33,4906.25)
DefineMap(443,764.583,1145.83,-2041.67,-1627.08)
DefineMap(991,456.25,683.334,-545.834,-2091.67)
DefineMap(975,456.25,683.334,-545.834,-2091.67)
DefineMap(615,3233.33,4850,-6681.25,4756.25)
DefineMap(971,456.25,683.334,-545.834,-2091.67)
DefineMap(981,468.75,702.083,-4885.42,-5814.58)
DefineMap(465,3443.75,5164.58,-5539.58,-1481.25)
DefineMap(182,4041.67,6062.5,-1797.92,-7237.5)
DefineMap(463,2200,3300,2883.33,-5866.67)
DefineMap(983,1354.17,2031.25,1608.33,-1264.58)
DefineMap(485,11834.3,17751.4,-9217.15,-10593.4)
DefineMap(681,3010.42,4514.58,-4383.33,-2881.25)
DefineMap(873,1195.83,1793.75,-812.5,-1689.58)
DefineMap(501,1983.33,2975,-4329.17,-5716.67)
DefineMap(955,1600,2400,4083.33,-233.334)
DefineMap(301,1158.33,1737.5,-1722.92,7995.83)
DefineMap(933,2756.25,4135.42,-7654.17,-8147.92)
DefineMap(747,647.917,970.833,1004.17,10591.7)
DefineMap(502,2108.33,3162.5,4047.92,-3087.5)
DefineMap(39,2333.33,3500,-3016.67,9400)
DefineMap(748,4129.17,6193.75,-2441.67,8029.17)
DefineMap(381,1027.08,1539.58,-3187.5,-10464.6)
DefineMap(34,1800,2700,-833.333,9716.67)
DefineMap(749,624.317,936.475,-560.529,-214.17)
DefineMap(43,3843.75,5766.67,-1700,-4672.92)
DefineMap(878,312.5,468.75,875,-2389.58)
DefineMap(471,704.688,1056.77,-6533.63,-6523.65)
DefineMap(181,3677.08,5514.58,3372.92,-5381.25)
DefineMap(879,485.417,729.166,-2102.08,-4168.75)
DefineMap(945,3325,4987.5,-1506.25,-5760.42)
DefineMap(752,1733.33,2600,-2633.33,-1133.33)
DefineMap(880,616.667,925,1397.92,-2372.92)
DefineMap(475,3616.67,5425,-8845.83,-4408.33)
DefineMap(881,560.416,839.583,-1743.75,-2083.33)
DefineMap(1009,458.333,687.5,3625,-3908.33)
DefineMap(626,810.417,1214.58,-931.25,-2266.67)
DefineMap(882,604.166,906.249,-1220.83,2564.58)
DefineMap(1010,1445.83,2168.75,-1995.83,-2977.08)
DefineMap(261,2706.25,4058.33,-2983.33,5872.92)
DefineMap(883,1789.58,2683.33,-5616.67,252.084)
DefineMap(1011,533.333,800,3589.58,-5541.67)
DefineMap(476,2175,3262.5,-7525,-9375)
DefineMap(884,647.917,970.833,-747.917,-2216.67)
DefineMap(382,640.104,959.375,-873.193,-1877.95)
DefineMap(757,2266.67,3400,-1166.67,-600)
DefineMap(962,15157.2,22735.8,-12242.3,-11193)

def Translate(desde, x, y, to):
    global Maps
    xx = Maps[desde]["width"] * x / 100.0
    yy = Maps[desde]["height"] * y / 100.0
    xx = xx + Maps[desde]["xOffset"]
    yy = yy + Maps[desde]["yOffset"]
    # Now in absolute coordinates now translate into new map
    xx = xx -  Maps[to]["xOffset"]
    yy = yy - Maps[to]["yOffset"]
    xx = xx / Maps[to]["width"]
    yy = yy / Maps[to]["height"]
    xx = xx * 100.0
    yy = yy * 100.0
    return (xx, yy)


def MapTranslate(origin, mline, destination):
    new = []
#    print "#MapTranslate(%s,%s,%s)" % (origin, mline, destination)
    for entry in mline.split(";"):
        coord = entry.split(",")
        x = float(coord[0])
        y = float(coord[1])
        xy = Translate(origin, x , y , destination)
        new.append("%2.2f,%2.2f" % xy)
    return ";".join(new)
        
def ShiftMap(lua, origin, destination):
    file=open(lua,"rU")
    map = re.compile('(.+)\|M\|([0-9.,;]+)\|(.+)')
    for line in file:
        m = map.search(line)
        if m:
            newMap = MapTranslate(origin, m.group(2), destination)
            before = m.group(1)
            after = m.group(3)
            newLine = before + "|M|" + newMap + "|" + after
            print newLine
        else:
            print line
        
            
            

if __name__ == "__main__":
    ShiftMap(sys.argv[1], int(sys.argv[2]), int(sys.argv[3]))


